pipeline {

  agent any
  parameters {
      //string (name: 'VERSION', defaultValue:'',description: 'version to deploy')
      choice(name:'VERSION',choices:['1.1.0','1.2.0','1.3.0'], description:'')
      booleanParam(name:'executeTests',defaultValue: true,description:'')
  
  }
  
  environment {
      NEW_VERSION = '1.3.0'
      SERVER_CREDENTIALS = credentials('admin')
  }
  
  stages{
    stage("checkout"){
    
      steps{
        echo "checking out code"
      }
    }
    stage("build"){
    
      steps{
        echo "building code"
        echo "building version ${NEW_VERSION}"
      }
    }
     stage("unit test"){
        
        when {
            expression {
                  env.BRANCH_NAME =='master' && params.executeTests == true            
            }
        }
      steps{
        echo "branch name ${env.BRANCH_NAME}"
        echo "running unit tests"
      }
    }
     stage("integration test"){
    
      steps{
          echo "running integration test"
      }
    }
    stage("packagging"){
    
      steps{
          echo "creating archive file"
      }
    }
    stage("deploying"){
    
      steps{
        echo "deploying application"
        echo "deploying with ${SERVER_CREDENTIALS}"
        echo "deploying version ${params.VERSION}"
      }
    }
  }

}
